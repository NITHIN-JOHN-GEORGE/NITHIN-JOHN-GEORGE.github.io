<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>End to End CI/CD pipeline for java based application on K8s | Nithin John George</title>
<meta name="keywords" content="CI/CD, Jenkins, K8s">
<meta name="description" content="Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment.">
<meta name="author" content="">
<link rel="canonical" href="https://nithin-john-george.github.io/projects/end-to-end-ci-cd-pipeline/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.a72801f0f40a8d7f71aa1cafd1c2f2a993a1f26ca1cfd38fdba65d5b9b0f08a0.css" integrity="sha256-pygB8PQKjX9xqhyv0cLyqZOh8myhz9OP26ZdW5sPCKA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.5b9ae0304f93db6cc493f51846f012428af399c614b4f2fbdb7fa59dd4d5ef5b.js" integrity="sha256-W5rgME&#43;T22zEk/UYRvASQorzmcYUtPL723&#43;lndTV71s="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://nithin-john-george.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://nithin-john-george.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://nithin-john-george.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://nithin-john-george.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://nithin-john-george.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="End to End CI/CD pipeline for java based application on K8s" />
<meta property="og:description" content="Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nithin-john-george.github.io/projects/end-to-end-ci-cd-pipeline/" />
<meta property="og:image" content="https://nithin-john-george.github.io/projects/ci-cd.jpeg" /><meta property="article:section" content="projects" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://nithin-john-george.github.io/projects/ci-cd.jpeg" />
<meta name="twitter:title" content="End to End CI/CD pipeline for java based application on K8s"/>
<meta name="twitter:description" content="Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Projects",
      "item": "https://nithin-john-george.github.io/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "End to End CI/CD pipeline for java based application on K8s",
      "item": "https://nithin-john-george.github.io/projects/end-to-end-ci-cd-pipeline/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "End to End CI/CD pipeline for java based application on K8s",
  "name": "End to End CI\/CD pipeline for java based application on K8s",
  "description": "Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment.",
  "keywords": [
    "CI/CD", "Jenkins", "K8s"
  ],
  "articleBody": "Description Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment.\nProject Flow 1. Developer pushes code into Github. 2. Webhook triggers Jenkins when there is a change in the code 3. Jenkins Pulls the Code from the Github 4. Maven builds the code and generates artifacts 5. Code quality is measured with Sonarqube 6. Quality Gate Check , If Quality Gate Fails Jenkins Job will fail !!!!!! (Triggered by Sonarqube Webhooks) 7. Upload artifact generated into Sonatype Nexus . It will dynamically choose Snapshot or release repository based on the version tag in pom.xml 8. Build Docker Image based on the Dockerfile with projectname \u0026\u0026 commit-id as tag . So each time it will be different. 9. Push Docker Image to private ECR docker registry. 10.Dynamically change image in pod template in manifest file. 11.Deploy to K8s cluster created with kubeadm . It will pull image from private registry. 12. Send Build Notification over Slack Channel and email notification when build is success/failure. Note: We can add an approval step before deploying to K8s cluster as an input from user. Features 1. Zero downtime deployment with rolling update as deployment strategy 2. Complete automation as when developer check in code , deployed to k8s cluster 3. Versioning of docker images , build artifacts. 4. Code checked against Code coverage and whether coding stantards are met. Pipeline Execution Execution Results SONARQUBE REPORTS\nNEXUS UPLOADING\nECR\nJOB TRIGGERED BY WEBHOOKS\nK8s CLUSTER\nController --\u003e Deployment Strategy --\u003e Rolling Update SLACK NOTIFICATION\nEMAIL NOTIFICATION\nFINAL RESULT\nJenkins Pipeline Change account number and credentials as per your environment.\ndef COMMIT def BRANCH_NAME def GIT_BRANCH pipeline { agent any environment { AWS_ACCOUNT_ID=\"\" AWS_DEFAULT_REGION=\"us-east-1\" IMAGE_REPO_NAME=\"mavenwebapp\" REPOSITORY_URI = \"${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com/${IMAGE_REPO_NAME}\" } tools { maven 'MAVEN_3.8.4' } options { buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '4', daysToKeepStr: '', numToKeepStr: '4') timestamps() } stages { stage('Code checkout') { steps { script { checkout([$class: 'GitSCM', branches: [[name: '*/development']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/NITHIN-JOHN-GEORGE/JAVA-CI-CD-PIPELINE.git']]]) COMMIT = sh (script: \"git rev-parse --short=10 HEAD\", returnStdout: true).trim() } } } stage('Build') { steps { sh \"mvn clean package\" } } stage('Execute Sonarqube Report') { steps { withSonarQubeEnv('Sonarqube-Server') { sh \"mvn sonar:sonar\" } } } stage('Quality Gate Check') { steps { timeout(time: 1, unit: 'HOURS') { waitForQualityGate abortPipeline: true, credentialsId: 'SONARQUBE-CRED' } } } stage('Nexus Upload') { steps { script { def readPom = readMavenPom file: 'pom.xml' def nexusrepo = readPom.version.endsWith(\"SNAPSHOT\") ? \"wallmart-snapshot\" : \"wallmart-release\" nexusArtifactUploader artifacts: [ [ artifactId: \"${readPom.artifactId}\", classifier: '', file: \"target/${readPom.artifactId}-${readPom.version}.war\", type: 'war' ] ], credentialsId: 'Nexus-Cred', groupId: \"${readPom.groupId}\", nexusUrl: '3.82.213.203:8081', nexusVersion: 'nexus3', protocol: 'http', repository: \"${nexusrepo}\", version: \"${readPom.version}\" } } } stage('Login to AWS ECR') { steps { script { sh \"/usr/local/bin/aws ecr get-login-password --region ${AWS_DEFAULT_REGION} | docker login --username AWS --password-stdin ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com\" } } } stage('Building Docker Image') { steps { script { sh \"docker build . -t ${REPOSITORY_URI}:mavenwebapp-${COMMIT}\" } } } stage('Pushing Docker image into ECR') { steps { script { sh \"docker push ${REPOSITORY_URI}:mavenwebapp-${COMMIT}\" } } } stage('Update image in K8s manifest file') { steps { sh \"\"\"#!/bin/bash sed -i 's/VERSION/$COMMIT/g' deployment.yaml \"\"\" } } stage('Deploy to K8s cluster') { steps { sh 'kubectl apply -f deployment.yaml --record=true' sh \"\"\"#!/bin/bash sed -i 's/$COMMIT/VERSION/g' deployment.yaml \"\"\" } } } post { always { cleanWs() } success { slackSend channel: 'build-notifications',color: 'good', message: \"started JOB : ${env.JOB_NAME} with BUILD NUMBER : ${env.BUILD_NUMBER} BUILD_STATUS: - ${currentBuild.currentResult} To view the dashboard (\u003c${env.BUILD_URL}|Open\u003e)\" emailext attachLog: true, body: '''BUILD IS SUCCESSFULL - $PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS: Check console output at $BUILD_URL to view the results. Regards, Nithin John George ''', compressLog: true, replyTo: '', subject: '$PROJECT_NAME - $BUILD_NUMBER - $BUILD_STATUS', to: 'njdevops321@gmail.com' } failure { slackSend channel: 'build-notifications',color: 'danger', message: \"started JOB : ${env.JOB_NAME} with BUILD NUMBER : ${env.BUILD_NUMBER} BUILD_STATUS: - ${currentBuild.currentResult} To view the dashboard (\u003c${env.BUILD_URL}|Open\u003e)\" emailext attachLog: true, body: '''BUILD IS FAILED - $PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS: Check console output at $BUILD_URL to view the results. Regards, Nithin John George ''', compressLog: true, replyTo: '', subject: '$PROJECT_NAME - $BUILD_NUMBER - $BUILD_STATUS', to: '' } } } K8s manifest File (Deployment) apiVersion: apps/v1 kind: Deployment metadata: name: mavenwebapp-dp labels: app: mavenwebapp spec: replicas: 4 revisionHistoryLimit: 10 strategy: type: RollingUpdate rollingUpdate: maxSurge: 2 maxUnavailable: 1 minReadySeconds: 30 selector: matchLabels: app: mavenwebapp template: metadata: name: mavenwebapp-pod labels: app: mavenwebapp spec: imagePullSecrets: - name: regcrd containers: - name: mavenwebapp-container image: .dkr.ecr.us-east-1.amazonaws.com/mavenwebapp:mavenwebapp-VERSION imagePullPolicy: Always ports: - containerPort: 8080 resources: requests: cpu: 300m memory: 256Mi limits: cpu: 800m memory: 1Gi --- apiVersion: v1 kind: Service metadata: name: mavenwebapp-svc spec: type: NodePort selector: app: mavenwebapp ports: - port: 8080 targetPort: 8080 nodePort: 30003 Docker File FROM tomcat:8.0.20-jre8 COPY target/java-web-app*.war /usr/local/tomcat/webapps/java-web-app.war ",
  "wordCount" : "789",
  "inLanguage": "en",
  "image":"https://nithin-john-george.github.io/projects/ci-cd.jpeg","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nithin-john-george.github.io/projects/end-to-end-ci-cd-pipeline/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nithin John George",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nithin-john-george.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="https://nithin-john-george.github.io/" accesskey="h" title="Nithin John George (Alt + H)">Nithin John George</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://nithin-john-george.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://nithin-john-george.github.io/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://nithin-john-george.github.io/projects" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="https://nithin-john-george.github.io/experience" title="Experience">
                    <span>Experience</span>
                </a>
            </li>
            <li>
                <a href="https://nithin-john-george.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://nithin-john-george.github.io/technical-skills/technical-skills/" title="Skills">
                    <span>Skills</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://nithin-john-george.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://nithin-john-george.github.io/projects/">Projects</a></div>
    <h1 class="post-title">
      End to End CI/CD pipeline for java based application on K8s
    </h1>
    <div class="post-description">
      Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment.
    </div>
    <div class="post-meta">


Feb 2022

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://nithin-john-george.github.io/projects/ci-cd.jpeg" alt="">
        
</figure>
  <div class="post-content"><h2 id="description">Description<a hidden class="anchor" aria-hidden="true" href="#description">#</a></h2>
<p>Project on End to End CI/CD pipeline for java based application using Git,Github,Jenkins,Maven,Sonarqube,Nexus,Slack,Docker and Kuberenets with ECR as private docker registry and Zero Downtime Deployment.</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660142-349279ac-e756-4d2c-abc8-acca3f12d958.JPG" alt="end-to-end-cicd-FLOW"  />
</p>
<hr>
<h2 id="project-flow">Project Flow<a hidden class="anchor" aria-hidden="true" href="#project-flow">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>1. Developer pushes code into Github.
</span></span><span style="display:flex;"><span>2. Webhook triggers Jenkins when there is a change in the code
</span></span><span style="display:flex;"><span>3. Jenkins Pulls the Code from the Github
</span></span><span style="display:flex;"><span>4. Maven builds the code and generates artifacts
</span></span><span style="display:flex;"><span>5. Code quality is measured with Sonarqube
</span></span><span style="display:flex;"><span>6. Quality Gate Check , If Quality Gate Fails Jenkins Job will fail !!!!!! <span style="color:#f92672">(</span>Triggered by Sonarqube Webhooks<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>7. Upload artifact generated into Sonatype Nexus . It will dynamically choose Snapshot or release repository based on the version tag in pom.xml
</span></span><span style="display:flex;"><span>8. Build Docker Image based on the Dockerfile with projectname <span style="color:#f92672">&amp;&amp;</span> commit-id as tag . So each time it will be different.
</span></span><span style="display:flex;"><span>9. Push Docker Image to private ECR docker registry.
</span></span><span style="display:flex;"><span>10.Dynamically change image in pod template in manifest file.
</span></span><span style="display:flex;"><span>11.Deploy to K8s cluster created with kubeadm . It will pull image from private registry.
</span></span><span style="display:flex;"><span>12. Send Build Notification over Slack Channel and email notification when build is success/failure.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: We can add an approval step before deploying to K8s cluster as an input from user.
</span></span></code></pre></div><hr>
<h2 id="features">Features<a hidden class="anchor" aria-hidden="true" href="#features">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>1. Zero downtime deployment with rolling update as deployment strategy
</span></span><span style="display:flex;"><span>2. Complete automation as when developer check in code , deployed to k8s cluster
</span></span><span style="display:flex;"><span>3. Versioning of docker images , build artifacts.
</span></span><span style="display:flex;"><span>4. Code checked against Code coverage and whether coding stantards are met.
</span></span></code></pre></div><hr>
<h2 id="pipeline-execution">Pipeline Execution<a hidden class="anchor" aria-hidden="true" href="#pipeline-execution">#</a></h2>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660815-81535f95-a123-48d9-a4dc-73d2849a9fde.JPG" alt="JENKINS-PIPELINE-VIEW-MAIN"  />
</p>
<h2 id="execution-results">Execution Results<a hidden class="anchor" aria-hidden="true" href="#execution-results">#</a></h2>
<p>SONARQUBE REPORTS</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660873-3f392176-1387-46f5-8d92-4f35011eb6d1.JPG" alt="SONAR REPORT"  />
</p>
<p>NEXUS UPLOADING</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660904-bc77d9a6-5e3e-43ab-9e31-e09d6a16b20d.JPG" alt="NEXUS REPOSITORY"  />
</p>
<p>ECR</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660928-0e337f03-4e69-45cb-99ea-9b4b4d8a0e8f.JPG" alt="ECR REPO"  />
</p>
<p>JOB TRIGGERED BY WEBHOOKS</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660992-0ac37278-5d83-4c70-ad9d-2048490464c4.JPG" alt="GITHUB-WEBHOOK-PUSH"  />
</p>
<p>K8s CLUSTER</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Controller --&gt; Deployment
</span></span><span style="display:flex;"><span>Strategy --&gt; Rolling Update
</span></span></code></pre></div><p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152660993-5f416527-ad3b-4b4d-9b76-59aa68b2804d.JPG" alt="K8S cluster"  />
</p>
<p>SLACK NOTIFICATION</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152661219-32260921-02b7-44d7-aa2c-8966f5e55114.JPG" alt="SLACK - NOTIFICATION"  />
</p>
<p>EMAIL NOTIFICATION</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152661223-51e1bcf7-5a73-4f55-8f6e-5e3cc1995ae7.JPG" alt="EMAIL NOTIFICATION"  />
</p>
<p>FINAL RESULT</p>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/96073033/152661000-a29889f0-0f6f-4a60-8375-7c477fa9f95c.JPG" alt="FINAL UPDATE"  />
</p>
<h2 id="jenkins-pipeline">Jenkins Pipeline<a hidden class="anchor" aria-hidden="true" href="#jenkins-pipeline">#</a></h2>
<p>Change account number and credentials as per your environment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def COMMIT
</span></span><span style="display:flex;"><span>def BRANCH_NAME
</span></span><span style="display:flex;"><span>def GIT_BRANCH
</span></span><span style="display:flex;"><span>pipeline
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> agent any
</span></span><span style="display:flex;"><span> environment
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     AWS_ACCOUNT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;Your account Id&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     AWS_DEFAULT_REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us-east-1&#34;</span> 
</span></span><span style="display:flex;"><span>     IMAGE_REPO_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mavenwebapp&#34;</span>
</span></span><span style="display:flex;"><span>     REPOSITORY_URI <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>AWS_ACCOUNT_ID<span style="color:#e6db74">}</span><span style="color:#e6db74">.dkr.ecr.</span><span style="color:#e6db74">${</span>AWS_DEFAULT_REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">.amazonaws.com/</span><span style="color:#e6db74">${</span>IMAGE_REPO_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> tools
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      maven <span style="color:#e6db74">&#39;MAVEN_3.8.4&#39;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> options 
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  buildDiscarder logRotator<span style="color:#f92672">(</span>artifactDaysToKeepStr: <span style="color:#e6db74">&#39;&#39;</span>, artifactNumToKeepStr: <span style="color:#e6db74">&#39;4&#39;</span>, daysToKeepStr: <span style="color:#e6db74">&#39;&#39;</span>, numToKeepStr: <span style="color:#e6db74">&#39;4&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  timestamps<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> stages
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Code checkout&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             script
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                 checkout<span style="color:#f92672">([</span>$class: <span style="color:#e6db74">&#39;GitSCM&#39;</span>, branches: <span style="color:#f92672">[[</span>name: <span style="color:#e6db74">&#39;*/development&#39;</span><span style="color:#f92672">]]</span>, extensions: <span style="color:#f92672">[]</span>, userRemoteConfigs: <span style="color:#f92672">[[</span>url: <span style="color:#e6db74">&#39;https://github.com/NITHIN-JOHN-GEORGE/JAVA-CI-CD-PIPELINE.git&#39;</span><span style="color:#f92672">]]])</span>
</span></span><span style="display:flex;"><span>                 COMMIT <span style="color:#f92672">=</span> sh <span style="color:#f92672">(</span>script: <span style="color:#e6db74">&#34;git rev-parse --short=10 HEAD&#34;</span>, returnStdout: true<span style="color:#f92672">)</span>.trim<span style="color:#f92672">()</span>  
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Build&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             sh <span style="color:#e6db74">&#34;mvn clean package&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Execute Sonarqube Report&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            withSonarQubeEnv<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Sonarqube-Server&#39;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                sh <span style="color:#e6db74">&#34;mvn sonar:sonar&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Quality Gate Check&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             timeout<span style="color:#f92672">(</span>time: 1, unit: <span style="color:#e6db74">&#39;HOURS&#39;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                waitForQualityGate abortPipeline: true, credentialsId: <span style="color:#e6db74">&#39;SONARQUBE-CRED&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Nexus Upload&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             script
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                 def readPom <span style="color:#f92672">=</span> readMavenPom file: <span style="color:#e6db74">&#39;pom.xml&#39;</span>
</span></span><span style="display:flex;"><span>                 def nexusrepo <span style="color:#f92672">=</span> readPom.version.endsWith<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SNAPSHOT&#34;</span><span style="color:#f92672">)</span> ? <span style="color:#e6db74">&#34;wallmart-snapshot&#34;</span> : <span style="color:#e6db74">&#34;wallmart-release&#34;</span>
</span></span><span style="display:flex;"><span>                 nexusArtifactUploader artifacts: 
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                         artifactId: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>readPom.artifactId<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                         classifier: <span style="color:#e6db74">&#39;&#39;</span>, 
</span></span><span style="display:flex;"><span>                         file: <span style="color:#e6db74">&#34;target/</span><span style="color:#e6db74">${</span>readPom.artifactId<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>readPom.version<span style="color:#e6db74">}</span><span style="color:#e6db74">.war&#34;</span>, 
</span></span><span style="display:flex;"><span>                         type: <span style="color:#e6db74">&#39;war&#39;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">]</span>, 
</span></span><span style="display:flex;"><span>                         credentialsId: <span style="color:#e6db74">&#39;Nexus-Cred&#39;</span>, 
</span></span><span style="display:flex;"><span>                         groupId: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>readPom.groupId<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, 
</span></span><span style="display:flex;"><span>                         nexusUrl: <span style="color:#e6db74">&#39;3.82.213.203:8081&#39;</span>, 
</span></span><span style="display:flex;"><span>                         nexusVersion: <span style="color:#e6db74">&#39;nexus3&#39;</span>, 
</span></span><span style="display:flex;"><span>                         protocol: <span style="color:#e6db74">&#39;http&#39;</span>, 
</span></span><span style="display:flex;"><span>                         repository: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>nexusrepo<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, 
</span></span><span style="display:flex;"><span>                         version: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>readPom.version<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Login to AWS ECR&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             script
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                 sh <span style="color:#e6db74">&#34;/usr/local/bin/aws ecr get-login-password --region </span><span style="color:#e6db74">${</span>AWS_DEFAULT_REGION<span style="color:#e6db74">}</span><span style="color:#e6db74"> | docker login --username AWS --password-stdin </span><span style="color:#e6db74">${</span>AWS_ACCOUNT_ID<span style="color:#e6db74">}</span><span style="color:#e6db74">.dkr.ecr.</span><span style="color:#e6db74">${</span>AWS_DEFAULT_REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">.amazonaws.com&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Building Docker Image&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             script
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>              sh <span style="color:#e6db74">&#34;docker build . -t </span><span style="color:#e6db74">${</span>REPOSITORY_URI<span style="color:#e6db74">}</span><span style="color:#e6db74">:mavenwebapp-</span><span style="color:#e6db74">${</span>COMMIT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Pushing Docker image into ECR&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             script
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                 sh <span style="color:#e6db74">&#34;docker push </span><span style="color:#e6db74">${</span>REPOSITORY_URI<span style="color:#e6db74">}</span><span style="color:#e6db74">:mavenwebapp-</span><span style="color:#e6db74">${</span>COMMIT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Update image in K8s manifest file&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>                 sh <span style="color:#e6db74">&#34;&#34;&#34;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 sed -i &#39;s/VERSION/</span>$COMMIT<span style="color:#e6db74">/g&#39; deployment.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>     stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Deploy to K8s cluster&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         steps
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>             sh <span style="color:#e6db74">&#39;kubectl apply -f deployment.yaml --record=true&#39;</span>
</span></span><span style="display:flex;"><span>             sh <span style="color:#e6db74">&#34;&#34;&#34;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             sed -i &#39;s/</span>$COMMIT<span style="color:#e6db74">/VERSION/g&#39; deployment.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> post
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     always
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         cleanWs<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     success
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        slackSend channel: <span style="color:#e6db74">&#39;build-notifications&#39;</span>,color: <span style="color:#e6db74">&#39;good&#39;</span>, message: <span style="color:#e6db74">&#34;started  JOB : </span><span style="color:#e6db74">${</span>env.JOB_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">  with BUILD NUMBER : </span><span style="color:#e6db74">${</span>env.BUILD_NUMBER<span style="color:#e6db74">}</span><span style="color:#e6db74">  BUILD_STATUS: - </span><span style="color:#e6db74">${</span>currentBuild.currentResult<span style="color:#e6db74">}</span><span style="color:#e6db74"> To view the dashboard (&lt;</span><span style="color:#e6db74">${</span>env.BUILD_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">|Open&gt;)&#34;</span>
</span></span><span style="display:flex;"><span>        emailext attachLog: true, body: <span style="color:#e6db74">&#39;&#39;&#39;BUILD IS SUCCESSFULL - $PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Check console output at $BUILD_URL to view the results.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Regards,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Nithin John George
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>, compressLog: true, replyTo: <span style="color:#e6db74">&#39;&lt;Your mail id&gt;&#39;</span>, 
</span></span><span style="display:flex;"><span>        subject: <span style="color:#e6db74">&#39;$PROJECT_NAME - $BUILD_NUMBER - $BUILD_STATUS&#39;</span>, to: <span style="color:#e6db74">&#39;njdevops321@gmail.com&#39;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     failure
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         slackSend channel: <span style="color:#e6db74">&#39;build-notifications&#39;</span>,color: <span style="color:#e6db74">&#39;danger&#39;</span>, message: <span style="color:#e6db74">&#34;started  JOB : </span><span style="color:#e6db74">${</span>env.JOB_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">  with BUILD NUMBER : </span><span style="color:#e6db74">${</span>env.BUILD_NUMBER<span style="color:#e6db74">}</span><span style="color:#e6db74">  BUILD_STATUS: - </span><span style="color:#e6db74">${</span>currentBuild.currentResult<span style="color:#e6db74">}</span><span style="color:#e6db74"> To view the dashboard (&lt;</span><span style="color:#e6db74">${</span>env.BUILD_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">|Open&gt;)&#34;</span>
</span></span><span style="display:flex;"><span>         emailext attachLog: true, body: <span style="color:#e6db74">&#39;&#39;&#39;BUILD IS FAILED - $PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Check console output at $BUILD_URL to view the results.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Regards,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Nithin John George
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>, compressLog: true, replyTo: <span style="color:#e6db74">&#39;&lt;Your mail id&gt;&#39;</span>, 
</span></span><span style="display:flex;"><span>        subject: <span style="color:#e6db74">&#39;$PROJECT_NAME - $BUILD_NUMBER - $BUILD_STATUS&#39;</span>, to: <span style="color:#e6db74">&#39;&lt;Your mail id&gt;&#39;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="k8s-manifest-file-deployment">K8s manifest File (Deployment)<a hidden class="anchor" aria-hidden="true" href="#k8s-manifest-file-deployment">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: mavenwebapp-dp
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: mavenwebapp
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  revisionHistoryLimit: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  strategy:
</span></span><span style="display:flex;"><span>    type: RollingUpdate
</span></span><span style="display:flex;"><span>    rollingUpdate:
</span></span><span style="display:flex;"><span>      maxSurge: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      maxUnavailable: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  minReadySeconds: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>       app: mavenwebapp
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      name: mavenwebapp-pod
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: mavenwebapp
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      imagePullSecrets:
</span></span><span style="display:flex;"><span>      - name: regcrd
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - name: mavenwebapp-container
</span></span><span style="display:flex;"><span>        image: &lt;AWS_ACCOUNT_NUMBER&gt;.dkr.ecr.us-east-1.amazonaws.com/mavenwebapp:mavenwebapp-VERSION
</span></span><span style="display:flex;"><span>        imagePullPolicy: Always
</span></span><span style="display:flex;"><span>        ports:
</span></span><span style="display:flex;"><span>        - containerPort: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>        resources:
</span></span><span style="display:flex;"><span>          requests:
</span></span><span style="display:flex;"><span>            cpu: 300m
</span></span><span style="display:flex;"><span>            memory: 256Mi
</span></span><span style="display:flex;"><span>          limits:
</span></span><span style="display:flex;"><span>            cpu: 800m
</span></span><span style="display:flex;"><span>            memory: 1Gi
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Service
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: mavenwebapp-svc
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  type: NodePort
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    app: mavenwebapp
</span></span><span style="display:flex;"><span>  ports:
</span></span><span style="display:flex;"><span>  - port: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    targetPort: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    nodePort: <span style="color:#ae81ff">30003</span>
</span></span></code></pre></div><h2 id="docker-file">Docker File<a hidden class="anchor" aria-hidden="true" href="#docker-file">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM tomcat:8.0.20-jre8
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>COPY target/java-web-app*.war /usr/local/tomcat/webapps/java-web-app.war
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://nithin-john-george.github.io/tags/ci/cd/">CI/CD</a></li>
      <li><a href="https://nithin-john-george.github.io/tags/jenkins/">Jenkins</a></li>
      <li><a href="https://nithin-john-george.github.io/tags/k8s/">K8s</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://nithin-john-george.github.io/">Nithin John George</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
